<%# default partial to display solr document fields in catalog show view -%>
<dl class="dl-horizontal dl-invert">
<!-- This is course reserve list <%= document["id"] %> -->
<%
items  = document["item_z"].collect{ |i| JSON.parse(i) }
nitems = items ? items.size : 0
eitems = items.select{ |i| !i["link"].nil? }
bibs   = items.select{ |i|  i["link"].nil? }.group_by{ |x| x["bib_id"] }.values.map{ |x| x[0] }
# The previous line groups items (as opposed to e-items) by bib ID, then winnows each group down
# to a single item (the first, not that it matters).

# First, show metadata (course, instructor, etc.)
document_show_fields(document).each do |field_name, field|
  if should_render_show_field? document, field
-%>
    <dt class="blacklight-<%= field_name.parameterize %>"><%= render_document_show_field_label document, field: field_name %></dt>
    <dd class="blacklight-<%= field_name.parameterize %>"><%= render_document_show_field_value document, field: field_name %></dd>
<%
  end
end

# Then list bibs
if bibs.size > 0
%>
    <dt class="blacklight-items">At a library:</dt>
    <dd class="blacklight-items">
<%
  bibs.sort{ |x, y| x["title"].downcase <=> y["title"].downcase }.each do |b|
%>
      <p style="padding-left: 2em; text-indent: -2em; margin-bottom: 0"><a href="/catalog/b<%= b["bib_id"] %>"><%= b["title"] %></a></p>
<%
  end
%>
    </dd>
<%
end

# And finally e-items
if eitems.size > 0
%>
    <dt class="blacklight-items">Online:</dt>
    <dd class="blacklight-items">
<%
  eitems.sort{ |x, y| x["title"].downcase <=> y["title"].downcase }.each do |e|
    title, link = e["title"], e["link"]
    url, label = link["url"], link["label"]
%>
      <p style="padding-left: 2em; text-indent: -2em; margin-bottom: 0"><%= title %><br /><a href="<%= url %>"><%= label %></a></p>
<%
  end
%>
    </dd>
<%
end
%>
</dl>
